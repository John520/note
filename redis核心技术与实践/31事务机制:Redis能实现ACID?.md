# Redis 事务命令
```
MULTI
{redis cmd}...
EXEC
```
在服务端暂存一个命令队列，在`EXEC`是一次执行，`DISCARD`丢弃队列中的命令

## 原子性
* 若`{redis cmd}`不合法，那么在入队列时报错，执行时，全部队列的命令都不执行（有原子性）
* 若`{redis cmd}`合法，但是命令对应的数据类型不对等，执行时，忽略该条命令，其他命令正常执行（无原子性）

## 一致性
* 命令入队列时报错（符合一致性）
* 命令执行时报错（不符合一致性）
* 命令执行时宕机
    * 开启RDB，事务命令执行时不会保存到RDB (符合一致性)
    * 开启AOF, 还没记录到AOF (符合一致性)， 已经记录部分AOF,开启`redis-check-aof`清除事务中的命令（符合一致性）
    
## 隔离性
* 在`EXEC`之前，使用`WATCH`来保证隔离性。`WATCH`在事务执行之前（`MULTI`之前）监视键值，若在`EXEC`执行时监视的键值被修改，则放弃事务执行

## 持久性
* AOF 最好的always 也会有一个命令的丢失可能
* RDB 若在事务执行之后，没有生成RDB,不能保证持久性
