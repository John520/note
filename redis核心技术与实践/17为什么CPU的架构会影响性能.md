# CPU架构影响CPU性能
## CPU架构
* 一个CPU有多个物理核
* 每个物理核下有（L1,L2缓存）
* L3缓存是多个物理核共享的
* 通过超线程技术，可以将一个物理核编程多个逻辑核
* 多CPU架构是指每个CPU socket 通过系统总线连接，每个CPU连接自己的内存，跨CPU访问内存耗时会增加（NUMA 非统一内存访问架构）

## 多核 CPU 对 redis 性能的影响
* 上下文切换（context switch）会导致性能变差（可以通过`vmstat`查看），L1,L2上的指令和数据需要重新缓存
* 将CPU逻辑核与Redis 实例绑定（`taskset -c 逻辑核号 ./redis-server`）
* 绑核能降低尾延，减低平均时延，提升吞吐率，提升redis性能

## 多 CPU 架构对 redis 性能影响
* 提升redis 网络性能，将操作系统的网络终端处理程序绑定到固定核上（避免网络中断处理程序在不同的核上切换）
* 在 CPU 的 NUMA 架构下,需避免将 redis 实例和 网络中断处理程序绑定在不同的 CPU socket，否则会导致跨CPU socket 访问内存时延增加  

## 绑核风险
* 将 redis 实例绑定到指定核上，主进程创建的子进程/后台线程都会在该核上调度，从而产生竞争关系

##解决方案
* 将redis 绑定到物理核上，而不是逻辑核上（`taskset -c 0,12 ./redis-server`,其中0，12 为同个物理核上的两个逻辑核号）
* 修改代码，将创建的线程或进程绑定到与主线程不同的逻辑核上（`sched_setaffinity`）